#include <jni.h>
#include <dlfcn.h>
#include <android/log.h>
#include <stdlib.h>
//#include <mcpe.h>
#include <Substrate.h>

#define LOG_TAG "feature"

#define LOGI(...) ((void)__android_log_print(ANDROID_LOG_INFO, LOG_TAG, __VA_ARGS__))

struct Random;
struct Block;

struct VanillaBlocks
{
	static const Block *mStone;
	static const Block *mGrass;
	static const Block *mDirt;
	static const Block *mCobblestone;
	static const Block *mWoodPlanks;
	static const Block *mSapling;
	static const Block *mBedrock;
	static const Block *mFlowingWater;
	static const Block *mStillWater;
	static const Block *mFlowingLava;
	static const Block *mStillLava;
	static const Block *mSand;
	static const Block *mGravel;
	static const Block *mGoldOre;
	static const Block *mIronOre;
	static const Block *mCoalOre;
	static const Block *mLog;
	static const Block *mLeaves;
	static const Block *mBorder;
	static const Block *mAllow;
	static const Block *mDeny;
	static const Block *mSponge;
	static const Block *mGlass;
	static const Block *mLapisOre;
	static const Block *mLapisBlock;
	static const Block *mDispenser;
	static const Block *mSandStone;
	static const Block *mNote;
	static const Block *mBed;
	static const Block *mGoldenRail;
	static const Block *mDetectorRail;
	static const Block *mWeb;
	static const Block *mTallgrass;
	static const Block *mDeadBush;
	static const Block *mPiston;
	static const Block *mStickyPiston;
	static const Block *mPistonArm;
	static const Block *mMovingBlock;
	static const Block *mObserver;
	static const Block *mWool;
	static const Block *mYellowFlower;
	static const Block *mRedFlower;
	static const Block *mBrownMushroom;
	static const Block *mRedMushroom;
	static const Block *mGoldBlock;
	static const Block *mIronBlock;
	static const Block *mDoubleStoneSlab;
	static const Block *mStoneSlab;
	static const Block *mBrick;
	static const Block *mTNT;
	static const Block *mBookshelf;
	static const Block *mMossyCobblestone;
	static const Block *mObsidian;
	static const Block *mTorch;
	static const Block *mMobSpawner;
	static const Block *mOakStairs;
	static const Block *mChest;
	static const Block *mRedStoneDust;
	static const Block *mDiamondOre;
	static const Block *mDiamondBlock;
	static const Block *mWorkBench;
	static const Block *mWheatCrop;
	static const Block *mFarmland;
	static const Block *mFurnace;
	static const Block *mLitFurnace;
	static const Block *mSign;
	static const Block *mWoodenDoor;
	static const Block *mLadder;
	static const Block *mRail;
	static const Block *mStoneStairs;
	static const Block *mWallSign;
	static const Block *mLever;
	static const Block *mStonePressurePlate;
	static const Block *mIronDoor;
	static const Block *mWoodPressurePlate;
	static const Block *mRedStoneOre;
	static const Block *mLitRedStoneOre;
	static const Block *mUnlitRedStoneTorch;
	static const Block *mLitRedStoneTorch;
	static const Block *mStoneButton;
	static const Block *mTopSnow;
	static const Block *mIce;
	static const Block *mSnow;
	static const Block *mBlueIce;
	static const Block *mCactus;
	static const Block *mClay;
	static const Block *mReeds;
	static const Block *mJukebox;
	static const Block *mFence;
	static const Block *mNetherFence;
	static const Block *mPumpkin;
	static const Block *mCarvedPumpkin;
	static const Block *mNetherrack;
	static const Block *mSoulSand;
	static const Block *mGlowStone;
	static const Block *mPortal;
	static const Block *mLitPumpkin;
	static const Block *mCake;
	static const Block *mUnpoweredRepeater;
	static const Block *mPoweredRepeater;
	static const Block *mInvisibleBedrock;
	static const Block *mTrapdoor;
	static const Block *mMonsterStoneEgg;
	static const Block *mStoneBrick;
	static const Block *mBrownMushroomBlock;
	static const Block *mRedMushroomBlock;
	static const Block *mIronFence;
	static const Block *mGlassPane;
	static const Block *mMelon;
	static const Block *mPumpkinStem;
	static const Block *mMelonStem;
	static const Block *mVine;
	static const Block *mFenceGateOak;
	static const Block *mBrickStairs;
	static const Block *mMycelium;
	static const Block *mWaterlily;
	static const Block *mBrewingStand;
	static const Block *mCauldron;
	static const Block *mEndPortal;
	static const Block *mEndPortalFrame;
	static const Block *mEndBrick;
	static const Block *mEndStone;
	static const Block *mEndRod;
	static const Block *mUnlitRedStoneLamp;
	static const Block *mLitRedStoneLamp;
	static const Block *mCocoa;
	static const Block *mEmeraldOre;
	static const Block *mEmeraldBlock;
	static const Block *mSpruceStairs;
	static const Block *mBirchStairs;
	static const Block *mJungleStairs;
	static const Block *mBeacon;
	static const Block *mConduitBlock;
	static const Block *mWoodButton;
	static const Block *mAcaciaStairs;
	static const Block *mDarkOakStairs;
	static const Block *mStoneBrickStairs;
	static const Block *mNetherBrick;
	static const Block *mNetherBrickStairs;
	static const Block *mNetherWart;
	static const Block *mEnchantingTable;
	static const Block *mDropper;
	static const Block *mActivatorRail;
	static const Block *mSandstoneStairs;
	static const Block *mTripwireHook;
	static const Block *mTripwire;
	static const Block *mWallBlock;
	static const Block *mFlowerPot;
	static const Block *mCarrotCrop;
	static const Block *mPotatoCrop;
	static const Block *mSkull;
	static const Block *mAnvil;
	static const Block *mTrappedChest;
	static const Block *mLightWeightedPressurePlate;
	static const Block *mHeavyWeightedPressurePlate;
	static const Block *mUnpoweredComparator;
	static const Block *mPoweredComparator;
	static const Block *mCommandBlock;
	static const Block *mRepeatingCommandBlock;
	static const Block *mChainCommandBlock;
	static const Block *mStandingBanner;
	static const Block *mWallBanner;
	static const Block *mDaylightDetector;
	static const Block *mRedstoneBlock;
	static const Block *mQuartzOre;
	static const Block *mHopper;
	static const Block *mBoneBlock;
	static const Block *mQuartzBlock;
	static const Block *mQuartzStairs;
	static const Block *mPurpurBlock;
	static const Block *mPurpurStairs;
	static const Block *mChorusPlantBlock;
	static const Block *mChorusFlowerBlock;
	static const Block *mDoubleWoodenSlab;
	static const Block *mWoodenSlab;
	static const Block *mStainedClay;
	static const Block *mLeaves2;
	static const Block *mLog2;
	static const Block *mSlimeBlock;
	static const Block *mMagmaBlock;
	static const Block *mIronTrapdoor;
	static const Block *mHayBlock;
	static const Block *mWoolCarpet;
	static const Block *mCoalBlock;
	static const Block *mHardenedClay;
	static const Block *mPackedIce;
	static const Block *mDoublePlant;
	static const Block *mDaylightDetectorInverted;
	static const Block *mRedSandstone;
	static const Block *mRedSandstoneStairs;
	static const Block *mDoubleStoneSlab2;
	static const Block *mStoneSlab2;
	static const Block *mDoubleStoneSlab3;
	static const Block *mStoneSlab3;
	static const Block *mDoubleStoneSlab4;
	static const Block *mStoneSlab4;
	static const Block *mSpruceFenceGate;
	static const Block *mBirchFenceGate;
	static const Block *mJungleFenceGate;
	static const Block *mDarkOakFenceGate;
	static const Block *mAcaciaFenceGate;
	static const Block *mWoodenDoorSpruce;
	static const Block *mWoodenDoorBirch;
	static const Block *mWoodenDoorJungle;
	static const Block *mWoodenDoorAcacia;
	static const Block *mWoodenDoorDarkOak;
	static const Block *mGrassPathBlock;
	static const Block *mDragonEgg;
	static const Block *mItemFrame;
	static const Block *mStructureBlock;
	static const Block *mStructureVoid;
	static const Block *mJigsawBlock;
	static const Block *mPodzol;
	static const Block *mBeetrootCrop;
	static const Block *mStonecutterBench;
	static const Block *mLegacyStonecutterBench;
	static const Block *mGlowingObsidian;
	static const Block *mNetherReactor;
	static const Block *mInfoUpdateGame1;
	static const Block *mInfoUpdateGame2;
	static const Block *mInfoReserved6;
	static const Block *mFire;
	static const Block *mEnderChest;
	static const Block *mEndGateway;
	static const Block *mStainedGlass;
	static const Block *mStainedGlassPane;
	static const Block *mPrismarine;
	static const Block *mSeaLantern;
	static const Block *mCameraBlock;
	static const Block *mChalkboard;
	static const Block *mUndyedShulkerBox;
	static const Block *mShulkerBox;
	static const Block *mFrostedIce;
	static const Block *mNetherWartBlock;
	static const Block *mRedNetherBrick;
	static const Block *mGlazedTerracottaWhite;
	static const Block *mGlazedTerracottaOrange;
	static const Block *mGlazedTerracottaMagenta;
	static const Block *mGlazedTerracottaLightBlue;
	static const Block *mGlazedTerracottaYellow;
	static const Block *mGlazedTerracottaLime;
	static const Block *mGlazedTerracottaPink;
	static const Block *mGlazedTerracottaGray;
	static const Block *mGlazedTerracottaSilver;
	static const Block *mGlazedTerracottaCyan;
	static const Block *mGlazedTerracottaPurple;
	static const Block *mGlazedTerracottaBlue;
	static const Block *mGlazedTerracottaBrown;
	static const Block *mGlazedTerracottaGreen;
	static const Block *mGlazedTerracottaRed;
	static const Block *mGlazedTerracottaBlack;
	static const Block *mConcrete;
	static const Block *mConcretePowder;
	static const Block *mStrippedSpruceLog;
	static const Block *mStrippedBirchLog;
	static const Block *mStrippedJungleLog;
	static const Block *mStrippedAcaciaLog;
	static const Block *mStrippedDarkOakLog;
	static const Block *mStrippedOakLog;
	static const Block *mSeaGrass;
	static const Block *mPrismarineStairs;
	static const Block *mDarkPrismarineStairs;
	static const Block *mPrismarineBricksStairs;
	static const Block *mCoral;
	static const Block *mCoralBlock;
	static const Block *mCoralFan;
	static const Block *mCoralFanDead;
	static const Block *mCoralFanHang;
	static const Block *mCoralFanHang2;
	static const Block *mCoralFanHang3;
	static const Block *mChemistryTable;
	static const Block *mUnderwaterTorch;
	static const Block *mHardGlass;
	static const Block *mHardStainedGlass;
	static const Block *mHardGlassPane;
	static const Block *mHardStainedGlassPane;
	static const Block *mChemicalHeat;
	static const Block *mColoredTorchRG;
	static const Block *mColoredTorchBP;
	static const Block *mElement0;
	static const Block *mElement1;
	static const Block *mElement2;
	static const Block *mElement3;
	static const Block *mElement4;
	static const Block *mElement5;
	static const Block *mElement6;
	static const Block *mElement7;
	static const Block *mElement8;
	static const Block *mElement9;
	static const Block *mElement10;
	static const Block *mElement11;
	static const Block *mElement12;
	static const Block *mElement13;
	static const Block *mElement14;
	static const Block *mElement15;
	static const Block *mElement16;
	static const Block *mElement17;
	static const Block *mElement18;
	static const Block *mElement19;
	static const Block *mElement20;
	static const Block *mElement21;
	static const Block *mElement22;
	static const Block *mElement23;
	static const Block *mElement24;
	static const Block *mElement25;
	static const Block *mElement26;
	static const Block *mElement27;
	static const Block *mElement28;
	static const Block *mElement29;
	static const Block *mElement30;
	static const Block *mElement31;
	static const Block *mElement32;
	static const Block *mElement33;
	static const Block *mElement34;
	static const Block *mElement35;
	static const Block *mElement36;
	static const Block *mElement37;
	static const Block *mElement38;
	static const Block *mElement39;
	static const Block *mElement40;
	static const Block *mElement41;
	static const Block *mElement42;
	static const Block *mElement43;
	static const Block *mElement44;
	static const Block *mElement45;
	static const Block *mElement46;
	static const Block *mElement47;
	static const Block *mElement48;
	static const Block *mElement49;
	static const Block *mElement50;
	static const Block *mElement51;
	static const Block *mElement52;
	static const Block *mElement53;
	static const Block *mElement54;
	static const Block *mElement55;
	static const Block *mElement56;
	static const Block *mElement57;
	static const Block *mElement58;
	static const Block *mElement59;
	static const Block *mElement60;
	static const Block *mElement61;
	static const Block *mElement62;
	static const Block *mElement63;
	static const Block *mElement64;
	static const Block *mElement65;
	static const Block *mElement66;
	static const Block *mElement67;
	static const Block *mElement68;
	static const Block *mElement69;
	static const Block *mElement70;
	static const Block *mElement71;
	static const Block *mElement72;
	static const Block *mElement73;
	static const Block *mElement74;
	static const Block *mElement75;
	static const Block *mElement76;
	static const Block *mElement77;
	static const Block *mElement78;
	static const Block *mElement79;
	static const Block *mElement80;
	static const Block *mElement81;
	static const Block *mElement82;
	static const Block *mElement83;
	static const Block *mElement84;
	static const Block *mElement85;
	static const Block *mElement86;
	static const Block *mElement87;
	static const Block *mElement88;
	static const Block *mElement89;
	static const Block *mElement90;
	static const Block *mElement91;
	static const Block *mElement92;
	static const Block *mElement93;
	static const Block *mElement94;
	static const Block *mElement95;
	static const Block *mElement96;
	static const Block *mElement97;
	static const Block *mElement98;
	static const Block *mElement99;
	static const Block *mElement100;
	static const Block *mElement101;
	static const Block *mElement102;
	static const Block *mElement103;
	static const Block *mElement104;
	static const Block *mElement105;
	static const Block *mElement106;
	static const Block *mElement107;
	static const Block *mElement108;
	static const Block *mElement109;
	static const Block *mElement110;
	static const Block *mElement111;
	static const Block *mElement112;
	static const Block *mElement113;
	static const Block *mElement114;
	static const Block *mElement115;
	static const Block *mElement116;
	static const Block *mElement117;
	static const Block *mElement118;
	static const Block *mKelp;
	static const Block *mDriedKelpBlock;
	static const Block *mButtonAcacia;
	static const Block *mButtonBirch;
	static const Block *mButtonDarkOak;
	static const Block *mButtonJungle;
	static const Block *mButtonSpruce;
	static const Block *mTrapdoorAcacia;
	static const Block *mTrapdoorBirch;
	static const Block *mTrapdoorDarkOak;
	static const Block *mTrapdoorJungle;
	static const Block *mTrapdoorSpruce;
	static const Block *mPressurePlateAcacia;
	static const Block *mPressurePlateBirch;
	static const Block *mPressurePlateDarkOak;
	static const Block *mPressurePlateJungle;
	static const Block *mPressurePlateSpruce;
	static const Block *mSeaPickle;
	static const Block *mBubbleColumn;
	static const Block *mTurtleEgg;
	static const Block *mBarrierBlock;
	static const Block *mBambooBlock;
	static const Block *mBambooSapling;
	static const Block *mScaffoldingBlock;
	static const Block *mGraniteStairs;
	static const Block *mDioriteStairs;
	static const Block *mAndesiteStairs;
	static const Block *mPolishedGraniteStairs;
	static const Block *mPolishedDioriteStairs;
	static const Block *mPolishedAndesiteStairs;
	static const Block *mMossyStoneBrickStairs;
	static const Block *mSmoothRedSandstoneStairs;
	static const Block *mSmoothSandstoneStairs;
	static const Block *mEndBrickStairs;
	static const Block *mMossyCobblestoneStairs;
	static const Block *mCobblestoneStairs;
	static const Block *mSmoothStone;
	static const Block *mRedNetherBrickStairs;
	static const Block *mSmoothQuartzStairs;
	static const Block *mSpruceSign;
	static const Block *mSpruceWallSign;
	static const Block *mBirchSign;
	static const Block *mBirchWallSign;
	static const Block *mJungleSign;
	static const Block *mJungleWallSign;
	static const Block *mAcaciaSign;
	static const Block *mAcaciaWallSign;
	static const Block *mDarkOakSign;
	static const Block *mDarkOakWallSign;
	static const Block *mSmithingTable;
	static const Block *mSmokerBlock;
	static const Block *mLitSmokerBlock;
	static const Block *mBlastFurnace;
	static const Block *mLitBlastFurnace;
	static const Block *mBarrel;
	static const Block *mLantern;
	static const Block *mLavaCauldron;
	static const Block *mGrindstone;
	static const Block *mBellBlock;
	static const Block *mCartographyTableBlock;
	static const Block *mFletchingTable;
	static const Block *mCampfireBlock;
	static const Block *mLoomBlock;
	static const Block *mLecternBlock;
	static const Block *mWoodBlock;
	static const Block *mSweetBerryBushBlock;
	static const Block *mComposterBlock;
};

struct BlockPos
{
	int x, y, z;
};

struct BlockSource
{
	void setBlock(int, int, int, Block const &, int);
};

struct TreeFeature
{
	void place(BlockSource &, BlockPos const &, Random &, int) const;
	void _placeTrunk(BlockSource &, BlockPos const &, Random &, int) const;
	void _placeLeaf(BlockSource &, BlockPos const &) const;
};

//TreeFeature::_placeTrunk(BlockSource&, BlockPos const&, Random&, int) const
//TreeFeature::_placeLeaf(BlockSource&, BlockPos const&) const

/* void (*_TreeFeature_place_real)(TreeFeature *, BlockSource &, BlockPos const &, Random &, int);
void TreeFeature_place_hook(TreeFeature *_treefeature, BlockSource &_blocksource, BlockPos const &_blockpos, Random &_random, int _int)
{
	_blocksource.setBlock(_blockpos.x, _blockpos.y, _blockpos.z, *VanillaBlocks::mStone, 0);
} */

void (*_TreeFeature__placeTrunk_real)(TreeFeature *, BlockSource &, BlockPos const &, Random &, int);
void TreeFeature__placeTrunk_hook(TreeFeature *_treefeature, BlockSource &_blocksource, BlockPos const &_blockpos, Random &_random, int _int) {
	for (int i = 0; i <= _int; i++)
		_blocksource.setBlock(_blockpos.x, _blockpos.y + i, _blockpos.z, *VanillaBlocks::mStone, 0);
}

void (*_TreeFeature__placeLeaf_real)(TreeFeature *, BlockSource &, BlockPos const &);
void TreeFeature__placeLeaf_hook(TreeFeature *_treefeature, BlockSource &_blocksource, BlockPos const &_blockpos) {
	_blocksource.setBlock(_blockpos.x, _blockpos.y, _blockpos.z, *VanillaBlocks::mIronOre, 0);
}

JNIEXPORT jint JNI_OnLoad(JavaVM *vm, void *reserved)
{
	LOGI("Hello world!");
	//MSHookFunction((void *)&TreeFeature::place, (void *)&TreeFeature_place_hook, (void **)&_TreeFeature_place_real);
	MSHookFunction((void *)&TreeFeature::_placeTrunk, (void *)&TreeFeature__placeTrunk_hook, (void **)&_TreeFeature__placeTrunk_real);
	MSHookFunction((void *)&TreeFeature::_placeLeaf, (void *)&TreeFeature__placeLeaf_hook, (void **)&_TreeFeature__placeLeaf_real);
	return JNI_VERSION_1_2;
}
